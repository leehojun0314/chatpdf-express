name: Deploy to VMSS
trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Deploy
  jobs:
  - deployment: Deploy
    displayName: 'Deploy to VMSS'
    environment:
      name: 'production'
      resourceType: 'VirtualMachineScaleSets'
    strategy:
      runOnce:
        deploy:
          steps:
          - task: AzureCLI@2
            inputs:
              azureSubscription: '<your-subscription>'
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                az vmss update-instances --instance-ids "*" --resource-group <your-resource-group> --name <your-vmss-name>
